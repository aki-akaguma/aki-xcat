# Requirements for aki-xcat

## 1. Core Functionality

- The primary function of `aki-xcat` is to concatenate files and print them to standard output, similar to the standard `cat` utility.
- It must be able to read from multiple files specified as command-line arguments.
- If no files are specified, or if a file is specified as `-`, it must read from standard input.

## 2. Decompression

- The tool must automatically detect the file type and decompress files that are compressed.
- Supported compression formats are:
    - gzip (`.gz`)
    - xz (`.xz`)
    - zstd (`.zst`)
    - lz4 (`.lz4`)
    - bzip2 (`.bz2`)
- It should handle plain (uncompressed) text files as well.
- File type detection should be based on file magic numbers, not file extensions.

## 3. Output Formatting

- **Default Mode**: By default, the tool should output the raw content of the files, concatenated.
- **Binary Mode (`-b`, `--bin`)**: The tool must have a binary mode that treats files as binary data. In this mode, it should not perform any text-specific processing (like line-ending conversions).
- **Line Numbering (`-n`, `--number`)**: The tool must be able to prepend line numbers to each line of the output. The line numbering should be continuous across multiple files.
- **File Name Prefix (`-f`, `--file-name`)**: The tool must be able to prepend the file name to each line of the output.
- **Path Name Prefix (`--path-name`)**: The tool must be able to prepend the full path name to each line of the output.
- The formatting options (`-n`, `-f`, `--path-name`) can be used in combination.

## 4. Command-Line Interface (CLI)

- The CLI should be implemented using GNU-style options.
- It must provide a help message (`-H`, `--help`) that explains the usage, options, and arguments.
- It must provide a version message (`-V`, `--version`) that displays the program name and version.
- It should handle invalid options and provide appropriate error messages.

## 5. Error Handling

- The tool must handle file-not-found errors gracefully and print a clear error message.
- It must handle errors during file reading and decompression.
- It should handle broken pipe errors silently (exit gracefully without an error message).

## 6. Extensibility

- The tool should be designed in a modular way to allow for easy addition of new compression formats or output formatting options in the future.
- The core logic should be in a library crate, and the executable should be a thin wrapper around the library. This allows the core logic to be used in other programs.